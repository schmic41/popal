<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">Vxc</span>,<span class="var type1" id="S3T2U4">Exc</span>,<span class="var type1" id="S4T2U5">rhoInt</span>] = int_xc(<span class="var type1" id="S5T3U8">basis</span>,<span class="var type1" id="S6T1U9">P</span>,<span class="var type1" id="S7T5U10">grid</span>,<span class="var type1" id="S8T8U11">ExchFunctional</span>,<span class="var type1" id="S9T9U12">CorrFunctional</span>,<span class="var type1" id="S10T10U13">evaluated_funcs</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="mxinfo " id="T2:U10"><span class="var type1" id="S11T2U16">Cx</span> = (<span class="mxinfo " id="T2:U12">(<span class="mxinfo " id="T2:U13"><span class="mxinfo " id="T2:U14">3</span>/<span class="mxinfo " id="T2:U15">4</span></span>)*(<span class="mxinfo " id="T2:U16">(<span class="mxinfo " id="T2:U17">3/pi</span>)^(1/3)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T7:U18"><span class="var type1" id="S13T7U36">Vc</span> = <span class="mxinfo " id="T7:U20">zeros(<span class="mxinfo " id="T2:U21">size(<span class="mxinfo " id="T6:U22"><span class="var type1" id="S7T5U42">grid</span>.xyz</span>,1)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T7:U24"><span class="var type1" id="S16T7U48">Vx</span> = <span class="mxinfo " id="T7:U26">zeros(<span class="mxinfo " id="T2:U27">size(<span class="mxinfo " id="T6:U28"><span class="var type1" id="S7T5U54">grid</span>.xyz</span>,1)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T7:U30"><span class="var type1" id="S17T7U60">Ex</span> = <span class="mxinfo " id="T7:U32">zeros(<span class="mxinfo " id="T2:U33">size(<span class="mxinfo " id="T6:U34"><span class="var type1" id="S7T5U66">grid</span>.xyz</span>,1)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T7:U36"><span class="var type1" id="S18T7U72">Ec</span> = <span class="mxinfo " id="T7:U38">zeros(<span class="mxinfo " id="T2:U39">size(<span class="mxinfo " id="T6:U40"><span class="var type1" id="S7T5U78">grid</span>.xyz</span>,1)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T2:U42"><span class="var type1" id="S4T2U84">rhoInt</span> = <span class="mxinfo " id="T2:U44">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T7:U45"><span class="var type1" id="S19T7U88">rho</span> = <span class="mxinfo " id="T7:U47">zeros(<span class="mxinfo " id="T2:U48">size(<span class="mxinfo " id="T6:U49"><span class="var type1" id="S7T5U94">grid</span>.xyz</span>,1)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Calculate density matrix here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S20T2U100">point</span> = <span class="mxinfo " id="T2:U52">1</span>:<span class="mxinfo " id="T2:U53">size(<span class="mxinfo " id="T6:U54"><span class="var type1" id="S7T5U106">grid</span>.xyz</span>,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S21T2U111">r</span> = <span class="mxinfo " id="T2:U57">1</span>:<span class="mxinfo " id="T2:U58">length(<span class="var type1" id="S5T3U116">basis</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S23T2U119">s</span> = <span class="mxinfo " id="T2:U61">1</span>:<span class="mxinfo " id="T2:U62">length(<span class="var type1" id="S5T3U124">basis</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">            <span class="mxinfo " id="T2:U64"><span class="mxinfo " id="T2:U65"><span class="var type1" id="S19T7U128">rho</span>(<span class="var type1" id="S20T2U129">point</span>,<span class="mxinfo " id="T2:U68">1</span>)</span> = <span class="mxinfo " id="T2:U69"><span class="mxinfo " id="T2:U70"><span class="var type1" id="S19T7U133">rho</span>(<span class="var type1" id="S20T2U134">point</span>)</span> + (<span class="mxinfo " id="T2:U73"><span class="mxinfo " id="T2:U74"><span class="mxinfo " id="T2:U75"><span class="var type1" id="S10T10U139">evaluated_funcs</span>(<span class="var type1" id="S21T2U140">r</span>,<span class="var type1" id="S20T2U141">point</span>)</span> * <span class="mxinfo " id="T2:U79"><span class="var type1" id="S10T10U143">evaluated_funcs</span>(<span class="var type1" id="S23T2U144">s</span>,<span class="var type1" id="S20T2U145">point</span>)</span></span> * <span class="mxinfo " id="T2:U83"><span class="var type1" id="S6T1U147">P</span>(<span class="var type1" id="S21T2U148">r</span>,<span class="var type1" id="S23T2U149">s</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T2:U87"><span class="var type1" id="S4T2U152">rhoInt</span> = <span class="mxinfo " id="T2:U89"><span class="var type1" id="S4T2U154">rhoInt</span> + (<span class="mxinfo " id="T2:U91"><span class="mxinfo " id="T2:U92"><span class="var type1" id="S19T7U158">rho</span>(<span class="var type1" id="S20T2U159">point</span>)</span>*<span class="mxinfo " id="T2:U95"><span class="mxinfo " id="T7:U96"><span class="var type1" id="S7T5U162">grid</span>.weights</span>(<span class="var type1" id="S20T2U164">point</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">    <span class="comment">% Slater exchange functional</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T11:U99"><span class="keyword">if</span> <span class="mxinfo " id="T12:U100"><span class="var type1" id="S8T8U168">ExchFunctional</span> == <span class="mxinfo " id="T8:U102"><span class="string">'Slater'</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">        <span class="mxinfo " id="T2:U103"><span class="mxinfo " id="T2:U104"><span class="var type1" id="S17T7U173">Ex</span>(<span class="var type1" id="S20T2U174">point</span>)</span> = (<span class="mxinfo " id="T2:U107">(<span class="mxinfo " id="T2:U108"><span class="mxinfo " id="T2:U109"><span class="var type1" id="S19T7U180">rho</span>(<span class="var type1" id="S20T2U181">point</span>)</span>^(1/3)</span>)*<span class="mxinfo " id="T2:U112">-<span class="var type1" id="S11T2U187">Cx</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">        <span class="mxinfo " id="T2:U114"><span class="mxinfo " id="T2:U115"><span class="var type1" id="S16T7U191">Vx</span>(<span class="var type1" id="S20T2U192">point</span>)</span> = (<span class="mxinfo " id="T2:U118"><span class="mxinfo " id="T2:U119">(<span class="mxinfo " id="T2:U120"><span class="mxinfo " id="T2:U121"><span class="var type1" id="S19T7U199">rho</span>(<span class="var type1" id="S20T2U200">point</span>)</span>^(1/3)</span>)*<span class="mxinfo " id="T2:U124">-<span class="var type1" id="S11T2U206">Cx</span></span></span>*(<span class="mxinfo " id="T2:U126"><span class="mxinfo " id="T2:U127">4</span>/<span class="mxinfo " id="T2:U128">3</span></span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">        error(<span class="string">'ExchFunctional not recognized!'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">    <span class="comment">% xr and A are defined here!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T11:U129"><span class="mxinfo " id="T2:U130"><span class="var type1" id="S19T7U220">rho</span>(<span class="var type1" id="S20T2U221">point</span>)</span> &lt; <span class="mxinfo " id="T2:U133">1e-10</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">        <span class="mxinfo " id="T2:U134"><span class="mxinfo " id="T2:U135"><span class="var type1" id="S18T7U226">Ec</span>(<span class="var type1" id="S20T2U227">point</span>)</span> = <span class="mxinfo " id="T2:U138">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">        <span class="mxinfo " id="T2:U139"><span class="mxinfo " id="T2:U140"><span class="var type1" id="S13T7U232">Vc</span>(<span class="var type1" id="S20T2U233">point</span>)</span> = <span class="mxinfo " id="T2:U143">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">        <span class="mxinfo " id="T2:U144"><span class="var type1" id="S25T2U238">xr</span> = <span class="mxinfo " id="T2:U146">(<span class="mxinfo " id="T2:U147"><span class="mxinfo " id="T2:U148">3</span>/(<span class="mxinfo " id="T2:U149"><span class="mxinfo " id="T2:U150"><span class="mxinfo " id="T2:U151">4</span>*<span class="mxinfo " id="T2:U152">pi</span></span>*<span class="mxinfo " id="T2:U153"><span class="var type1" id="S19T7U250">rho</span>(<span class="var type1" id="S20T2U251">point</span>)</span></span>)</span>)^(1/6)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">        <span class="mxinfo " id="T2:U156"><span class="var type1" id="S26T2U258">A</span> = <span class="mxinfo " id="T2:U158">0.0310907</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">        <span class="comment">% Correction Functional</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">        <span class="mxinfo " id="T11:U159"><span class="keyword">if</span> <span class="mxinfo " id="T13:U160"><span class="var type1" id="S9T9U263">CorrFunctional</span> == <span class="mxinfo " id="T9:U162"><span class="string">'VWN3'</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">            <span class="mxinfo " id="T2:U163"><span class="var type1" id="S27T2U267">b</span> = <span class="mxinfo " id="T2:U165">13.0720</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">            <span class="mxinfo " id="T2:U166"><span class="var type1" id="S28T2U271">c</span> = <span class="mxinfo " id="T2:U168">42.7198</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">            <span class="mxinfo " id="T2:U169"><span class="var type1" id="S29T2U275">x0</span> = <span class="mxinfo " id="T2:U171">-0.409286</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">            <span class="mxinfo " id="T2:U172"><span class="var type1" id="S30T2U280">Q</span> = <span class="mxinfo " id="T2:U174">sqrt((4*<span class="var type1" id="S28T2U287">c</span>)-<span class="var type1" id="S27T2U289">b</span>^2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">            <span class="mxinfo " id="T2:U177"><span class="var type1" id="S32T2U293">nu</span> = <span class="mxinfo " id="T2:U179">atan(<span class="mxinfo " id="T2:U180"><span class="var type1" id="S30T2U297">Q</span>/(<span class="mxinfo " id="T2:U182">(<span class="mxinfo " id="T2:U183"><span class="mxinfo " id="T2:U184">2</span>*<span class="var type1" id="S25T2U303">xr</span></span>)+<span class="var type1" id="S27T2U304">b</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">            <span class="mxinfo " id="T2:U187"><span class="mxinfo " id="T2:U188"><span class="var type1" id="S18T7U308">Ec</span>(<span class="var type1" id="S20T2U309">point</span>)</span> = (<span class="mxinfo " id="T2:U191"><span class="var type1" id="S26T2U312">A</span> * (<span class="mxinfo " id="T2:U193"><span class="mxinfo " id="T2:U194"><span class="mxinfo " id="T2:U195">log(<span class="mxinfo " id="T2:U196">(<span class="mxinfo " id="T2:U197"><span class="var type1" id="S25T2U321">xr</span>^2</span>)/(<span class="mxinfo " id="T2:U199"><span class="mxinfo " id="T2:U200"><span class="mxinfo " id="T2:U201"><span class="var type1" id="S25T2U327">xr</span>^2</span> + (<span class="mxinfo " id="T2:U203"><span class="var type1" id="S27T2U331">b</span>*<span class="var type1" id="S25T2U332">xr</span></span>)</span> + <span class="var type1" id="S28T2U333">c</span></span>)</span>)</span> + (<span class="mxinfo " id="T2:U207">(<span class="mxinfo " id="T2:U208"><span class="mxinfo " id="T2:U209"><span class="mxinfo " id="T2:U210">2</span>*<span class="var type1" id="S27T2U340">b</span></span>*<span class="var type1" id="S32T2U341">nu</span></span>)/<span class="var type1" id="S30T2U342">Q</span></span>)</span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">                - (<span class="mxinfo " id="T2:U214">(<span class="mxinfo " id="T2:U215">(<span class="mxinfo " id="T2:U216"><span class="var type1" id="S27T2U349">b</span>*<span class="var type1" id="S29T2U350">x0</span></span>)/(<span class="mxinfo " id="T2:U219"><span class="var type1" id="S29T2U355">x0</span>^2 + (<span class="var type1" id="S27T2U359">b</span>*<span class="var type1" id="S29T2U360">x0</span>) + <span class="var type1" id="S28T2U361">c</span></span>)</span>) * (<span class="mxinfo " id="T2:U224"><span class="mxinfo " id="T2:U225">log(<span class="mxinfo " id="T2:U226">(<span class="mxinfo " id="T2:U227">(<span class="mxinfo " id="T2:U228"><span class="var type1" id="S25T2U371">xr</span>-<span class="var type1" id="S29T2U372">x0</span></span>)^2</span>)/(<span class="mxinfo " id="T2:U231"><span class="mxinfo " id="T2:U232"><span class="mxinfo " id="T2:U233"><span class="var type1" id="S25T2U378">xr</span>^2</span> + (<span class="mxinfo " id="T2:U235"><span class="var type1" id="S27T2U382">b</span>*<span class="var type1" id="S25T2U383">xr</span></span>)</span> + <span class="var type1" id="S28T2U384">c</span></span>)</span>)</span> + (<span class="mxinfo " id="T2:U239">(<span class="mxinfo " id="T2:U240"><span class="mxinfo " id="T2:U241"><span class="mxinfo " id="T2:U242">2</span>*<span class="var type1" id="S32T2U391">nu</span></span>*(<span class="mxinfo " id="T2:U244">(<span class="mxinfo " id="T2:U245"><span class="mxinfo " id="T2:U246">2</span>*<span class="var type1" id="S29T2U397">x0</span></span>)+<span class="var type1" id="S27T2U398">b</span></span>)</span>) / <span class="var type1" id="S30T2U399">Q</span></span>)</span>)</span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">            <span class="mxinfo " id="T2:U250"><span class="mxinfo " id="T2:U251"><span class="var type1" id="S13T7U403">Vc</span>(<span class="var type1" id="S20T2U404">point</span>)</span> = (<span class="mxinfo " id="T2:U254"><span class="mxinfo " id="T2:U255"><span class="var type1" id="S18T7U408">Ec</span>(<span class="var type1" id="S20T2U409">point</span>)</span> - (<span class="mxinfo " id="T2:U258">(<span class="mxinfo " id="T2:U259"><span class="var type1" id="S26T2U414">A</span>/<span class="mxinfo " id="T2:U261">3</span></span>) * (<span class="mxinfo " id="T2:U262">(<span class="mxinfo " id="T2:U263">(<span class="mxinfo " id="T2:U264"><span class="var type1" id="S28T2U422">c</span>*(<span class="mxinfo " id="T2:U266"><span class="var type1" id="S25T2U425">xr</span>-<span class="var type1" id="S29T2U426">x0</span></span>)</span>) - (<span class="mxinfo " id="T2:U269"><span class="mxinfo " id="T2:U270"><span class="var type1" id="S27T2U430">b</span>*<span class="var type1" id="S25T2U431">xr</span></span>*<span class="var type1" id="S29T2U432">x0</span></span>)</span>) / (<span class="mxinfo " id="T2:U274">(<span class="mxinfo " id="T2:U275"><span class="mxinfo " id="T2:U276"><span class="mxinfo " id="T2:U277"><span class="var type1" id="S25T2U439">xr</span>^2</span> + (<span class="mxinfo " id="T2:U279"><span class="var type1" id="S27T2U443">b</span>*<span class="var type1" id="S25T2U444">xr</span></span>)</span> + <span class="var type1" id="S28T2U445">c</span></span>) * (<span class="mxinfo " id="T2:U283"><span class="var type1" id="S25T2U448">xr</span>-<span class="var type1" id="S29T2U449">x0</span></span>)</span>)</span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T13:U287"><span class="var type1" id="S9T9U452">CorrFunctional</span> == <span class="mxinfo " id="T9:U289"><span class="string">'VWN5'</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">            <span class="mxinfo " id="T2:U290"><span class="var type1" id="S27T2U456">b</span> = <span class="mxinfo " id="T2:U292">3.72744</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">            <span class="mxinfo " id="T2:U293"><span class="var type1" id="S28T2U460">c</span> = <span class="mxinfo " id="T2:U295">12.9352</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">            <span class="mxinfo " id="T2:U296"><span class="var type1" id="S29T2U464">x0</span> = <span class="mxinfo " id="T2:U298">-0.10498</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">            <span class="mxinfo " id="T2:U299"><span class="var type1" id="S30T2U469">Q</span> = <span class="mxinfo " id="T2:U301">sqrt((4*<span class="var type1" id="S28T2U476">c</span>)-<span class="var type1" id="S27T2U478">b</span>^2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">            <span class="mxinfo " id="T2:U304"><span class="var type1" id="S32T2U482">nu</span> = <span class="mxinfo " id="T2:U306">atan(<span class="mxinfo " id="T2:U307"><span class="var type1" id="S30T2U486">Q</span>/(<span class="mxinfo " id="T2:U309">(<span class="mxinfo " id="T2:U310"><span class="mxinfo " id="T2:U311">2</span>*<span class="var type1" id="S25T2U492">xr</span></span>)+<span class="var type1" id="S27T2U493">b</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">            <span class="mxinfo " id="T2:U314"><span class="mxinfo " id="T2:U315"><span class="var type1" id="S18T7U497">Ec</span>(<span class="var type1" id="S20T2U498">point</span>)</span> = (<span class="mxinfo " id="T2:U318"><span class="var type1" id="S26T2U501">A</span> * (<span class="mxinfo " id="T2:U320"><span class="mxinfo " id="T2:U321"><span class="mxinfo " id="T2:U322">log(<span class="mxinfo " id="T2:U323">(<span class="mxinfo " id="T2:U324"><span class="var type1" id="S25T2U510">xr</span>^2</span>)/(<span class="mxinfo " id="T2:U326"><span class="mxinfo " id="T2:U327"><span class="mxinfo " id="T2:U328"><span class="var type1" id="S25T2U516">xr</span>^2</span> + (<span class="mxinfo " id="T2:U330"><span class="var type1" id="S27T2U520">b</span>*<span class="var type1" id="S25T2U521">xr</span></span>)</span> + <span class="var type1" id="S28T2U522">c</span></span>)</span>)</span> + (<span class="mxinfo " id="T2:U334">(<span class="mxinfo " id="T2:U335"><span class="mxinfo " id="T2:U336"><span class="mxinfo " id="T2:U337">2</span>*<span class="var type1" id="S27T2U529">b</span></span>*<span class="var type1" id="S32T2U530">nu</span></span>)/<span class="var type1" id="S30T2U531">Q</span></span>)</span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">                - (<span class="mxinfo " id="T2:U341">(<span class="mxinfo " id="T2:U342">(<span class="mxinfo " id="T2:U343"><span class="var type1" id="S27T2U538">b</span>*<span class="var type1" id="S29T2U539">x0</span></span>)/(<span class="mxinfo " id="T2:U346"><span class="var type1" id="S29T2U544">x0</span>^2 + (<span class="var type1" id="S27T2U548">b</span>*<span class="var type1" id="S29T2U549">x0</span>) + <span class="var type1" id="S28T2U550">c</span></span>)</span>) * (<span class="mxinfo " id="T2:U351"><span class="mxinfo " id="T2:U352">log(<span class="mxinfo " id="T2:U353">(<span class="mxinfo " id="T2:U354">(<span class="mxinfo " id="T2:U355"><span class="var type1" id="S25T2U560">xr</span>-<span class="var type1" id="S29T2U561">x0</span></span>)^2</span>)/(<span class="mxinfo " id="T2:U358"><span class="mxinfo " id="T2:U359"><span class="mxinfo " id="T2:U360"><span class="var type1" id="S25T2U567">xr</span>^2</span> + (<span class="mxinfo " id="T2:U362"><span class="var type1" id="S27T2U571">b</span>*<span class="var type1" id="S25T2U572">xr</span></span>)</span> + <span class="var type1" id="S28T2U573">c</span></span>)</span>)</span> + (<span class="mxinfo " id="T2:U366">(<span class="mxinfo " id="T2:U367"><span class="mxinfo " id="T2:U368"><span class="mxinfo " id="T2:U369">2</span>*<span class="var type1" id="S32T2U580">nu</span></span>*(<span class="mxinfo " id="T2:U371">(<span class="mxinfo " id="T2:U372"><span class="mxinfo " id="T2:U373">2</span>*<span class="var type1" id="S29T2U586">x0</span></span>)+<span class="var type1" id="S27T2U587">b</span></span>)</span>) / <span class="var type1" id="S30T2U588">Q</span></span>)</span>)</span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">            <span class="mxinfo " id="T2:U377"><span class="mxinfo " id="T2:U378"><span class="var type1" id="S13T7U592">Vc</span>(<span class="var type1" id="S20T2U593">point</span>)</span> = (<span class="mxinfo " id="T2:U381"><span class="mxinfo " id="T2:U382"><span class="var type1" id="S18T7U597">Ec</span>(<span class="var type1" id="S20T2U598">point</span>)</span> - (<span class="mxinfo " id="T2:U385">(<span class="mxinfo " id="T2:U386"><span class="var type1" id="S26T2U603">A</span>/<span class="mxinfo " id="T2:U388">3</span></span>) * (<span class="mxinfo " id="T2:U389">(<span class="mxinfo " id="T2:U390">(<span class="mxinfo " id="T2:U391"><span class="var type1" id="S28T2U611">c</span>*(<span class="mxinfo " id="T2:U393"><span class="var type1" id="S25T2U614">xr</span>-<span class="var type1" id="S29T2U615">x0</span></span>)</span>) - (<span class="mxinfo " id="T2:U396"><span class="mxinfo " id="T2:U397"><span class="var type1" id="S27T2U619">b</span>*<span class="var type1" id="S25T2U620">xr</span></span>*<span class="var type1" id="S29T2U621">x0</span></span>)</span>) / (<span class="mxinfo " id="T2:U401">(<span class="mxinfo " id="T2:U402"><span class="mxinfo " id="T2:U403"><span class="mxinfo " id="T2:U404"><span class="var type1" id="S25T2U628">xr</span>^2</span> + (<span class="mxinfo " id="T2:U406"><span class="var type1" id="S27T2U632">b</span>*<span class="var type1" id="S25T2U633">xr</span></span>)</span> + <span class="var type1" id="S28T2U634">c</span></span>) * (<span class="mxinfo " id="T2:U410"><span class="var type1" id="S25T2U637">xr</span>-<span class="var type1" id="S29T2U638">x0</span></span>)</span>)</span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line">            error(<span class="string">'CorrFunctional not recognized!'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line">        <span class="mxinfo " id="T2:U413"><span class="mxinfo " id="T2:U414"><span class="var type1" id="S17T7U647">Ex</span>(<span class="var type1" id="S20T2U648">point</span>)</span> = <span class="mxinfo " id="T2:U417"><span class="mxinfo " id="T2:U418"><span class="var type1" id="S17T7U651">Ex</span>(<span class="var type1" id="S20T2U652">point</span>)</span> * <span class="mxinfo " id="T2:U421"><span class="mxinfo " id="T7:U422"><span class="var type1" id="S7T5U655">grid</span>.weights</span>(<span class="var type1" id="S20T2U657">point</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line">        <span class="mxinfo " id="T2:U425"><span class="mxinfo " id="T2:U426"><span class="var type1" id="S18T7U661">Ec</span>(<span class="var type1" id="S20T2U662">point</span>)</span> = <span class="mxinfo " id="T2:U429"><span class="mxinfo " id="T2:U430"><span class="var type1" id="S18T7U665">Ec</span>(<span class="var type1" id="S20T2U666">point</span>)</span> * <span class="mxinfo " id="T2:U433"><span class="mxinfo " id="T7:U434"><span class="var type1" id="S7T5U669">grid</span>.weights</span>(<span class="var type1" id="S20T2U671">point</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line"><span class="mxinfo " id="T7:U437"><span class="var type1" id="S35T7U674">exc</span> = <span class="mxinfo " id="T7:U439"><span class="var type1" id="S17T7U676">Ex</span> + <span class="var type1" id="S18T7U677">Ec</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line"><span class="mxinfo " id="T1:U442"><span class="var type1" id="S2T1U680">Vxc</span> = <span class="mxinfo " id="T1:U444">zeros(length(<span class="var type1" id="S5T3U685">basis</span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S21T2U688">r</span> = <span class="mxinfo " id="T2:U447">1</span>:<span class="mxinfo " id="T2:U448">length(<span class="var type1" id="S5T3U693">basis</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S23T2U696">s</span> = <span class="mxinfo " id="T2:U451">1</span>:<span class="mxinfo " id="T2:U452">length(<span class="var type1" id="S5T3U701">basis</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line">        <span class="mxinfo " id="T2:U454"><span class="var type1" id="S36T2U704">tempsum</span> = <span class="mxinfo " id="T2:U456">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S20T2U708">point</span> = <span class="mxinfo " id="T2:U458">1</span>:<span class="mxinfo " id="T2:U459">size(<span class="mxinfo " id="T6:U460"><span class="var type1" id="S7T5U714">grid</span>.xyz</span>,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line">            <span class="mxinfo " id="T2:U462"><span class="var type1" id="S36T2U719">tempsum</span> = <span class="mxinfo " id="T2:U464"><span class="var type1" id="S36T2U721">tempsum</span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73">73</a></span><span class="line">                (<span class="mxinfo " id="T2:U466"><span class="mxinfo " id="T2:U467"><span class="mxinfo " id="T2:U468"><span class="mxinfo " id="T2:U469"><span class="var type1" id="S10T10U727">evaluated_funcs</span>(<span class="var type1" id="S21T2U728">r</span>,<span class="var type1" id="S20T2U729">point</span>)</span>*<span class="mxinfo " id="T2:U473"><span class="var type1" id="S10T10U731">evaluated_funcs</span>(<span class="var type1" id="S23T2U732">s</span>,<span class="var type1" id="S20T2U733">point</span>)</span></span>*<span class="mxinfo " id="T2:U477"><span class="mxinfo " id="T7:U478"><span class="var type1" id="S7T5U736">grid</span>.weights</span>(<span class="var type1" id="S20T2U738">point</span>)</span></span>*(<span class="mxinfo " id="T2:U481"><span class="mxinfo " id="T2:U482"><span class="var type1" id="S16T7U742">Vx</span>(<span class="var type1" id="S20T2U743">point</span>)</span>+<span class="mxinfo " id="T2:U485"><span class="var type1" id="S13T7U745">Vc</span>(<span class="var type1" id="S20T2U746">point</span>)</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74">74</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75">75</a></span><span class="line">        <span class="mxinfo " id="T2:U488"><span class="mxinfo " id="T2:U489"><span class="var type1" id="S2T1U750">Vxc</span>(<span class="var type1" id="S21T2U751">r</span>,<span class="var type1" id="S23T2U752">s</span>)</span> = <span class="var type1" id="S36T2U753">tempsum</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76">76</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77">77</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78">78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79">79</a></span><span class="line"><span class="mxinfo " id="T2:U494"><span class="var type1" id="S3T2U756">Exc</span> = <span class="mxinfo " id="T2:U496">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80">80</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S20T2U760">point</span> = <span class="mxinfo " id="T2:U498">1</span>:<span class="mxinfo " id="T2:U499">size(<span class="mxinfo " id="T6:U500"><span class="var type1" id="S7T5U766">grid</span>.xyz</span>,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81">81</a></span><span class="line">    <span class="mxinfo " id="T2:U502"><span class="var type1" id="S3T2U771">Exc</span> = <span class="mxinfo " id="T2:U504"><span class="var type1" id="S3T2U773">Exc</span> + (<span class="mxinfo " id="T2:U506"><span class="mxinfo " id="T2:U507"><span class="var type1" id="S35T7U777">exc</span>(<span class="var type1" id="S20T2U778">point</span>)</span> * <span class="mxinfo " id="T2:U510"><span class="var type1" id="S19T7U780">rho</span>(<span class="var type1" id="S20T2U781">point</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82">82</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83">83</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84">84</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
